<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4A6FA5;
            --primary-light: #6B8FC3;
            --primary-dark: #385785;
            --secondary: #166088;
            --secondary-light: #1F7DB0;
            --danger: #D64933;
            --warning: #FF9F1C;
            --success: #2EC4B6;
            --dark: #1C1C1C;
            --dark-light: #2D2D2D;
            --light: #F8F9FA;
            --gray: #6C757D;
            --gray-light: #E9ECEF;
            
            --user-color-1: #4A6FA5;
            --user-color-2: #2EC4B6;
            --user-color-3: #9C4DFF;
            --user-color-4: #FF9F1C;
            --user-color-5: #D64933;
            --user-color-6: #166088;
            --user-color-7: #6B8FC3;
            --user-color-8: #1F7DB0;
            
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
            --radius: 16px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.2s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1C1C1C 0%, #2D2D2D 100%);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¯Ø®ÙˆÙ„ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.8s ease-out;
        }
        
        .auth-box {
            background: rgba(45, 45, 45, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 40px 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(74, 111, 165, 0.3);
            animation: slideInRight 0.6s ease-out;
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
            animation: pulse 3s infinite;
        }
        
        .auth-logo h1 {
            color: var(--light);
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .auth-logo p {
            color: var(--gray);
            font-size: 14px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: none;
            border: none;
            color: var(--gray);
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        
        .auth-tab.active {
            color: var(--primary);
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .auth-form {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            transition: var(--transition);
        }
        
        .form-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        .password-input {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }
        
        .auth-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .auth-error {
            background: rgba(214, 73, 51, 0.1);
            border: 1px solid rgba(214, 73, 51, 0.3);
            border-radius: var(--radius-sm);
            padding: 12px 15px;
            margin-top: 20px;
            color: #ff6b6b;
            font-size: 14px;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .auth-error.active {
            display: block;
        }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar {
            background: rgba(28, 28, 28, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(74, 111, 165, 0.2);
            display: none;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 22px;
            color: var(--primary);
            text-decoration: none;
        }
        
        .logo i {
            font-size: 26px;
            animation: pulse 2s infinite;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .online-users {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 14px;
        }
        
        .online-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .logout-btn {
            background: rgba(214, 73, 51, 0.2);
            border: 1px solid rgba(214, 73, 51, 0.3);
            color: #ff6b6b;
            border-radius: var(--radius-sm);
            padding: 8px 15px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background: rgba(214, 73, 51, 0.3);
            transform: translateY(-2px);
        }
        
        .hamburger {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            transition: var(--transition);
        }
        
        .hamburger:hover {
            transform: scale(1.1);
        }
        
        .hamburger span {
            display: block;
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 3px;
            transition: var(--transition);
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± */
        .dev-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
            opacity: 0;
            visibility: hidden;
        }
        
        .dev-panel.active {
            right: 0;
            opacity: 1;
            visibility: visible;
        }
        
        .panel-content {
            background: linear-gradient(145deg, #2D2D2D, #1C1C1C);
            width: 90%;
            max-width: 500px;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(74, 111, 165, 0.2);
        }
        
        .dev-panel.active .panel-content {
            transform: scale(1);
            animation: fadeIn 0.5s ease-out 0.2s both;
        }
        
        .panel-content::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }
        
        .close-panel {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            transition: var(--transition);
        }
        
        .close-panel:hover {
            background: var(--danger);
            transform: rotate(90deg);
        }
        
        .panel-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--light);
            font-size: 26px;
            font-weight: 700;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--primary);
        }
        
        .dev-controls {
            margin-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-label {
            display: block;
            margin-bottom: 10px;
            color: var(--light);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-label i {
            color: var(--primary);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 120px;
            font-family: 'Cairo', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #44D4C6);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #1EA89A, var(--success));
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #FFB347);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #E58F1A, var(--warning));
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #E55E48);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #C13823, var(--danger));
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .chat-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: none;
        }
        
        .chat-wrapper {
            background: rgba(28, 28, 28, 0.7);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 180px);
            min-height: 500px;
            border: 1px solid rgba(74, 111, 165, 0.1);
        }
        
        /* Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ© */
        .pinned-message-container {
            background: linear-gradient(135deg, rgba(255, 159, 28, 0.2), rgba(255, 159, 28, 0.1));
            padding: 15px 20px;
            border-bottom: 2px solid var(--warning);
            display: none;
            animation: fadeIn 0.5s ease-out;
            border-left: 4px solid var(--warning);
        }
        
        .pinned-message-container.active {
            display: block;
        }
        
        .pinned-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--warning);
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .pinned-label i {
            animation: bounce 2s infinite;
        }
        
        .pinned-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pinned-text {
            color: var(--light);
            font-weight: 500;
            flex: 1;
        }
        
        .pinned-sender {
            color: var(--warning);
            font-size: 14px;
            margin-right: 15px;
            font-weight: 600;
        }
        
        .unpin-btn {
            background: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .unpin-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--danger);
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: rgba(28, 28, 28, 0.3);
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .message {
            max-width: 75%;
            padding: 15px 18px;
            border-radius: var(--radius);
            position: relative;
            animation: fadeIn 0.4s ease-out;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            word-wrap: break-word;
            transition: var(--transition);
        }
        
        .message:hover {
            transform: translateY(-2px);
        }
        
        .message.user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-bottom-right-radius: 5px;
            border-left: 4px solid var(--primary-light);
        }
        
        .message.other-message {
            align-self: flex-start;
            background: rgba(45, 45, 45, 0.8);
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 5px;
            border-right: 4px solid;
        }
        
        .message.dev-message {
            align-self: center;
            background: linear-gradient(135deg, var(--success), #44D4C6);
            color: white;
            max-width: 85%;
            border-radius: 30px;
            font-weight: 600;
            text-align: center;
            padding: 12px 25px;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .message-sender {
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sender-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }
        
        .message-time {
            opacity: 0.8;
            font-size: 12px;
        }
        
        .message-text {
            line-height: 1.5;
            font-size: 15px;
        }
        
        .message-actions {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            transition: var(--transition);
        }
        
        .message:hover .message-actions {
            opacity: 1;
        }
        
        .message-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            transition: var(--transition);
        }
        
        .other-message .message-action-btn {
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
        }
        
        .message-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .other-message .message-action-btn:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .delete-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(214, 73, 51, 0.8);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: var(--transition);
        }
        
        .message:hover .delete-btn {
            opacity: 1;
        }
        
        .delete-btn:hover {
            background: var(--danger);
            transform: scale(1.1);
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .message-input-container {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(28, 28, 28, 0.8);
            display: flex;
            gap: 12px;
        }
        
        .message-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            font-size: 16px;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-family: 'Cairo', sans-serif;
        }
        
        .message-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        .message-input:disabled {
            background: rgba(255, 255, 255, 0.02);
            cursor: not-allowed;
        }
        
        .send-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .send-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(74, 111, 165, 0.4);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
        .footer {
            text-align: center;
            padding: 15px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary));
        }
        
        /* Ø£Ø­Ø±Ù Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        .color-1 { background: var(--user-color-1); border-color: var(--user-color-1); }
        .color-2 { background: var(--user-color-2); border-color: var(--user-color-2); }
        .color-3 { background: var(--user-color-3); border-color: var(--user-color-3); }
        .color-4 { background: var(--user-color-4); border-color: var(--user-color-4); }
        .color-5 { background: var(--user-color-5); border-color: var(--user-color-5); }
        .color-6 { background: var(--user-color-6); border-color: var(--user-color-6); }
        .color-7 { background: var(--user-color-7); border-color: var(--user-color-7); }
        .color-8 { background: var(--user-color-8); border-color: var(--user-color-8); }
        
        .border-color-1 { border-right-color: var(--user-color-1); }
        .border-color-2 { border-right-color: var(--user-color-2); }
        .border-color-3 { border-right-color: var(--user-color-3); }
        .border-color-4 { border-right-color: var(--user-color-4); }
        .border-color-5 { border-right-color: var(--user-color-5); }
        .border-color-6 { border-right-color: var(--user-color-6); }
        .border-color-7 { border-right-color: var(--user-color-7); }
        .border-color-8 { border-right-color: var(--user-color-8); }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¯Ø®ÙˆÙ„ */
        .message-enter {
            animation: slideInRight 0.4s ease-out;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-logo">
                <i class="fas fa-comments"></i>
                <h1>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­ÙŠØ©</h1>
                <p>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button class="auth-tab" id="registerTab">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" class="form-input" id="loginPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                        <button type="button" class="toggle-password" data-target="loginPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="auth-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                
                <div class="auth-error" id="loginError"></div>
            </form>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-input" id="registerUsername" placeholder="Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                    <small style="color: var(--gray); font-size: 12px; margin-top: 5px; display: block;">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 3-20 Ø­Ø±ÙØ§Ù‹</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" class="form-input" id="registerPassword" placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required>
                        <button type="button" class="toggle-password" data-target="registerPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <small style="color: var(--gray); font-size: 12px; margin-top: 5px; display: block;">ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" class="form-input" id="registerConfirmPassword" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                        <button type="button" class="toggle-password" data-target="registerConfirmPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="auth-btn" id="registerBtn">
                    <i class="fas fa-user-plus"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                </button>
                
                <div class="auth-error" id="registerError"></div>
            </form>
        </div>
    </div>
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
    <div class="top-bar" id="topBar">
        <div class="logo">
            <i class="fas fa-comments"></i>
            <span>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­ÙŠØ©</span>
        </div>
        
        <div class="user-info">
            <div class="online-users">
                <div class="online-dot"></div>
                <span id="onlineCount">1</span> Ù…ØªØµÙ„
            </div>
            <div class="user-avatar" id="userAvatar">
                <span id="avatarText">Ù…</span>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                Ø®Ø±ÙˆØ¬
            </button>
            <button class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
    
    <!-- Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ± -->
    <div class="dev-panel" id="devPanel">
        <div class="panel-content">
            <button class="close-panel" id="closePanel">
                <i class="fas fa-times"></i>
            </button>
            
            <h2 class="panel-title">
                <i class="fas fa-user-shield"></i>
                Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±
            </h2>
            
            <div class="dev-controls">
                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-comment"></i>
                        Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø·ÙˆØ±
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-input" id="devMessageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø·ÙˆØ±">
                        <button class="btn btn-success" id="sendDevMessage">
                            <i class="fas fa-paper-plane"></i>
                            Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-thumbtack"></i>
                        ØªØ«Ø¨ÙŠØª Ø±Ø³Ø§Ù„Ø©
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-input" id="pinMessageInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ©">
                        <button class="btn btn-warning" id="pinMessageBtn">
                            <i class="fas fa-thumbtack"></i>
                            ØªØ«Ø¨ÙŠØª
                        </button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-toggle-on"></i>
                        Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                    </label>
                    <div class="control-buttons">
                        <button class="btn btn-danger" id="disableSendingBtn">
                            <i class="fas fa-pause-circle"></i>
                            ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                        </button>
                        <button class="btn btn-success" id="enableSendingBtn">
                            <i class="fas fa-play-circle"></i>
                            ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-wrapper">
            <!-- Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ© -->
            <div class="pinned-message-container" id="pinnedMessageContainer">
                <div class="pinned-label">
                    <i class="fas fa-thumbtack"></i>
                    Ø±Ø³Ø§Ù„Ø© Ù…Ø«Ø¨ØªØ©
                </div>
                <div class="pinned-content">
                    <div class="pinned-sender">Ø§Ù„Ù…Ø·ÙˆØ±</div>
                    <div class="pinned-text" id="pinnedMessageText">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©!</div>
                    <button class="unpin-btn" id="unpinBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="messages-container" id="messagesContainer">
                <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <!-- Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="message-input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." autocomplete="off">
                <button class="send-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
    <div class="footer" id="footer">
        <p>Â© 2023 Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­ÙŠØ© | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC91IZelDtX3qf2InDFt7MMLamYrCBH0Yo",
            authDomain: "moudir-67596.firebaseapp.com",
            projectId: "moudir-67596",
            storageBucket: "moudir-67596.firebasestorage.app",
            messagingSenderId: "25298966640",
            appId: "1:25298966640:web:ddcc0e56989fa279197cb5",
            measurementId: "G-9C0G7M4ENT"
        };
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase Ùˆ Firestore
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.log("Firebase already initialized");
        }
        const db = firebase.firestore();
        
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const appState = {
            currentUser: null,
            isDevMode: false,
            sendingEnabled: true,
            pinnedMessage: null,
            onlineUsers: new Set(),
            unsubscribeMessages: null,
            unsubscribePinned: null,
            unsubscribeUsers: null,
            userColors: [
                'color-1', 'color-2', 'color-3', 'color-4',
                'color-5', 'color-6', 'color-7', 'color-8'
            ],
            borderColors: [
                'border-color-1', 'border-color-2', 'border-color-3', 'border-color-4',
                'border-color-5', 'border-color-6', 'border-color-7', 'border-color-8'
            ]
        };
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const authContainer = document.getElementById('authContainer');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginUsername = document.getElementById('loginUsername');
        const loginPassword = document.getElementById('loginPassword');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const registerUsername = document.getElementById('registerUsername');
        const registerPassword = document.getElementById('registerPassword');
        const registerConfirmPassword = document.getElementById('registerConfirmPassword');
        const registerBtn = document.getElementById('registerBtn');
        const registerError = document.getElementById('registerError');
        
        const topBar = document.getElementById('topBar');
        const chatContainer = document.getElementById('chatContainer');
        const footer = document.getElementById('footer');
        const userAvatar = document.getElementById('userAvatar');
        const avatarText = document.getElementById('avatarText');
        const logoutBtn = document.getElementById('logoutBtn');
        const onlineCount = document.getElementById('onlineCount');
        
        const hamburger = document.getElementById('hamburger');
        const devPanel = document.getElementById('devPanel');
        const closePanel = document.getElementById('closePanel');
        const devMessageInput = document.getElementById('devMessageInput');
        const sendDevMessage = document.getElementById('sendDevMessage');
        const pinMessageInput = document.getElementById('pinMessageInput');
        const pinMessageBtn = document.getElementById('pinMessageBtn');
        const disableSendingBtn = document.getElementById('disableSendingBtn');
        const enableSendingBtn = document.getElementById('enableSendingBtn');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const messagesContainer = document.getElementById('messagesContainer');
        const pinnedMessageContainer = document.getElementById('pinnedMessageContainer');
        const pinnedMessageText = document.getElementById('pinnedMessageText');
        const unpinBtn = document.getElementById('unpinBtn');
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initApp() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
            checkPreviousLogin();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners();
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
        function checkPreviousLogin() {
            const savedUser = localStorage.getItem('chat_user');
            
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    appState.currentUser = userData;
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·ÙˆØ±
                    if (userData.username === 'admin') {
                        appState.isDevMode = true;
                    }
                    
                    showChatInterface();
                    startChatSystem();
                } catch (error) {
                    console.error('Error parsing saved user:', error);
                    localStorage.removeItem('chat_user');
                }
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            loginTab.addEventListener('click', () => switchAuthTab('login'));
            registerTab.addEventListener('click', () => switchAuthTab('register'));
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const input = document.getElementById(targetId);
                    const icon = this.querySelector('i');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.className = 'fas fa-eye-slash';
                    } else {
                        input.type = 'password';
                        icon.className = 'fas fa-eye';
                    }
                });
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            loginForm.addEventListener('submit', handleLogin);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
            registerForm.addEventListener('submit', handleRegister);
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            logoutBtn.addEventListener('click', handleLogout);
            
            // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±
            hamburger.addEventListener('click', toggleDevPanel);
            closePanel.addEventListener('click', toggleDevPanel);
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø·ÙˆØ±
            sendDevMessage.addEventListener('click', sendMessageAsDev);
            devMessageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessageAsDev();
            });
            
            // ØªØ«Ø¨ÙŠØª Ø±Ø³Ø§Ù„Ø©
            pinMessageBtn.addEventListener('click', pinMessage);
            
            // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            disableSendingBtn.addEventListener('click', disableSending);
            enableSendingBtn.addEventListener('click', enableSending);
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            unpinBtn.addEventListener('click', unpinMessage);
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function switchAuthTab(tab) {
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
                loginError.classList.remove('active');
                registerError.classList.remove('active');
            } else {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.add('active');
                loginForm.classList.remove('active');
                loginError.classList.remove('active');
                registerError.classList.remove('active');
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
            if (!username || !password) {
                showAuthError('login', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase
                const usersRef = db.collection('users');
                const querySnapshot = await usersRef
                    .where('username', '==', username)
                    .limit(1)
                    .get();
                
                if (querySnapshot.empty) {
                    showAuthError('login', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                    return;
                }
                
                const userDoc = querySnapshot.docs[0];
                const userData = userDoc.data();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                if (userData.password !== password) {
                    showAuthError('login', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                    return;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
                await userDoc.ref.update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userColor = appState.userColors[Math.floor(Math.random() * appState.userColors.length)];
                const avatarChar = username.charAt(0).toUpperCase();
                
                appState.currentUser = {
                    id: userDoc.id,
                    username: userData.username,
                    color: userColor,
                    avatarChar: avatarChar,
                    createdAt: userData.createdAt,
                    lastLogin: new Date()
                };
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·ÙˆØ±
                if (username === 'admin' && password === 'ghedir38') {
                    appState.currentUser.isDev = true;
                    appState.isDevMode = true;
                }
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹
                localStorage.setItem('chat_user', JSON.stringify(appState.currentUser));
                
                // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                showChatInterface();
                startChatSystem();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                showAuthError('login', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
        async function handleRegister(e) {
            e.preventDefault();
            
            const username = registerUsername.value.trim();
            const password = registerPassword.value.trim();
            const confirmPassword = registerConfirmPassword.value.trim();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
            if (!username || !password || !confirmPassword) {
                showAuthError('register', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            if (username.length < 3 || username.length > 20) {
                showAuthError('register', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 3-20 Ø­Ø±ÙØ§Ù‹');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('register', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            if (password !== confirmPassword) {
                showAuthError('register', 'ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');
                return;
            }
            
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const usersRef = db.collection('users');
                const querySnapshot = await usersRef
                    .where('username', '==', username)
                    .limit(1)
                    .get();
                
                if (!querySnapshot.empty) {
                    showAuthError('register', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
                    return;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                const userData = {
                    username: username,
                    password: password,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const docRef = await usersRef.add(userData);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userColor = appState.userColors[Math.floor(Math.random() * appState.userColors.length)];
                const avatarChar = username.charAt(0).toUpperCase();
                
                appState.currentUser = {
                    id: docRef.id,
                    username: username,
                    color: userColor,
                    avatarChar: avatarChar,
                    createdAt: userData.createdAt,
                    lastLogin: new Date()
                };
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·ÙˆØ±
                if (username === 'admin' && password === 'ghedir38') {
                    appState.currentUser.isDev = true;
                    appState.isDevMode = true;
                }
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹
                localStorage.setItem('chat_user', JSON.stringify(appState.currentUser));
                
                // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                showChatInterface();
                startChatSystem();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
                showAuthError('register', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨');
                registerBtn.disabled = false;
                registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
            }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø®Ø·Ø£ ÙÙŠ Ù…ØµØ§Ø¯Ù‚Ø©
        function showAuthError(form, message) {
            const errorElement = form === 'login' ? loginError : registerError;
            errorElement.textContent = message;
            errorElement.classList.add('active');
            
            setTimeout(() => {
                errorElement.classList.remove('active');
            }, 5000);
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function showChatInterface() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©
            userAvatar.className = `user-avatar ${appState.currentUser.color}`;
            avatarText.textContent = appState.currentUser.avatarChar;
            
            // Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            authContainer.style.display = 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
            topBar.style.display = 'flex';
            chatContainer.style.display = 'block';
            footer.style.display = 'block';
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
            setTimeout(() => {
                topBar.style.animation = 'fadeIn 0.8s ease-out';
                chatContainer.style.animation = 'fadeIn 0.8s ease-out 0.2s both';
                footer.style.animation = 'fadeIn 0.8s ease-out 0.4s both';
            }, 100);
        }
        
        // Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function startChatSystem() {
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
            startListeningToMessages();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ©
            startListeningToPinnedMessage();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
            startListeningToActiveUsers();
            
            // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            registerUserActivity();
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Firestore
        function startListeningToMessages() {
            if (appState.unsubscribeMessages) {
                appState.unsubscribeMessages();
            }
            
            appState.unsubscribeMessages = db.collection('messages')
                .orderBy('timestamp', 'asc')
                .limit(100) // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                .onSnapshot((snapshot) => {
                    // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                    messagesContainer.innerHTML = '';
                    
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        message.id = doc.id;
                        displayMessage(message);
                    });
                    
                    // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
                    scrollToBottom();
                }, (error) => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„:', error);
                });
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ©
        function startListeningToPinnedMessage() {
            if (appState.unsubscribePinned) {
                appState.unsubscribePinned();
            }
            
            appState.unsubscribePinned = db.collection('pinned_messages')
                .doc('current')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const pinnedData = doc.data();
                        appState.pinnedMessage = pinnedData;
                        pinnedMessageText.textContent = pinnedData.text;
                        pinnedMessageContainer.classList.add('active');
                    } else {
                        appState.pinnedMessage = null;
                        pinnedMessageContainer.classList.remove('active');
                    }
                });
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
        function startListeningToActiveUsers() {
            if (appState.unsubscribeUsers) {
                appState.unsubscribeUsers();
            }
            
            appState.unsubscribeUsers = db.collection('active_users')
                .onSnapshot((snapshot) => {
                    appState.onlineUsers.clear();
                    
                    const now = Date.now();
                    snapshot.forEach((doc) => {
                        const user = doc.data();
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø´Ø§Ø· (Ø£Ù‚Ù„ Ù…Ù† 30 Ø«Ø§Ù†ÙŠØ©)
                        if (user.lastActive && (now - user.lastActive < 30000)) {
                            appState.onlineUsers.add(user.id);
                        }
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
                    updateOnlineCount();
                });
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function registerUserActivity() {
            if (!appState.currentUser) return;
            
            const userActivity = {
                id: appState.currentUser.id,
                username: appState.currentUser.username,
                color: appState.currentUser.color,
                lastActive: Date.now()
            };
            
            db.collection('active_users').doc(appState.currentUser.id).set(userActivity);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø· ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                if (appState.currentUser) {
                    userActivity.lastActive = Date.now();
                    db.collection('active_users').doc(appState.currentUser.id).set(userActivity);
                }
            }, 20000);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
        function updateOnlineCount() {
            const count = appState.onlineUsers.size;
            onlineCount.textContent = count;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        function displayMessage(messageData) {
            const messageElement = document.createElement('div');
            messageElement.id = `message-${messageData.id}`;
            messageElement.className = 'message message-enter';
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            let messageClass = '';
            let borderClass = '';
            
            if (messageData.type === 'dev') {
                messageClass = 'dev-message';
            } else if (messageData.senderId === appState.currentUser.id) {
                messageClass = 'user-message';
            } else {
                messageClass = 'other-message';
                
                // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø³Ù„
                if (messageData.senderColor) {
                    borderClass = `border-${messageData.senderColor}`;
                    messageElement.classList.add(borderClass);
                }
            }
            
            messageElement.classList.add(messageClass);
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
            let timeString = 'Ø§Ù„Ø¢Ù†';
            if (messageData.timestamp) {
                const messageTime = messageData.timestamp.toDate();
                const now = new Date();
                const diffMinutes = Math.floor((now - messageTime) / (1000 * 60));
                
                if (diffMinutes < 1) {
                    timeString = 'Ø§Ù„Ø¢Ù†';
                } else if (diffMinutes < 60) {
                    timeString = `Ù…Ù†Ø° ${diffMinutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
                } else {
                    timeString = messageTime.toLocaleTimeString('ar-SA', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            let messageContent = '';
            const senderAvatarChar = messageData.senderUsername ? messageData.senderUsername.charAt(0).toUpperCase() : '?';
            const senderColorClass = messageData.senderColor || 'color-1';
            
            if (messageData.type === 'dev') {
                messageContent = `
                    <div class="message-text">${messageData.text}</div>
                `;
            } else {
                messageContent = `
                    <div class="message-header">
                        <div class="message-sender">
                            <div class="sender-avatar ${senderColorClass}">${senderAvatarChar}</div>
                            ${messageData.senderUsername || 'Ù…Ø¬Ù‡ÙˆÙ„'}
                        </div>
                        <div class="message-time">${timeString}</div>
                    </div>
                    <div class="message-text">${messageData.text}</div>
                    <div class="message-actions">
                        <button class="message-action-btn reply-btn" title="Ø±Ø¯">
                            <i class="fas fa-reply"></i>
                        </button>
                    </div>
                `;
                
                // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
                if (appState.isDevMode) {
                    messageContent += `
                        <button class="delete-btn" title="Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                }
            }
            
            messageElement.innerHTML = messageContent;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            if (messageData.type !== 'dev') {
                const replyBtn = messageElement.querySelector('.reply-btn');
                if (replyBtn) {
                    replyBtn.addEventListener('click', () => {
                        messageInput.value = `@${messageData.senderUsername} `;
                        messageInput.focus();
                    });
                }
                
                if (appState.isDevMode) {
                    const deleteBtn = messageElement.querySelector('.delete-btn');
                    if (deleteBtn) {
                        deleteBtn.addEventListener('click', () => deleteMessage(messageData.id));
                    }
                }
            }
            
            messagesContainer.appendChild(messageElement);
        }
        
        // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø©
        async function deleteMessage(messageId) {
            if (!appState.isDevMode) return;
            
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) {
                try {
                    await db.collection('messages').doc(messageId).delete();
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
                }
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
        async function sendMessage() {
            if (!appState.sendingEnabled && !appState.isDevMode) {
                return;
            }
            
            const messageText = messageInput.value.trim();
            
            if (messageText === '') {
                return;
            }
            
            try {
                const messageData = {
                    text: messageText,
                    senderId: appState.currentUser.id,
                    senderUsername: appState.currentUser.username,
                    senderColor: appState.currentUser.color,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    type: appState.isDevMode ? 'dev' : 'user'
                };
                
                await db.collection('messages').add(messageData);
                messageInput.value = '';
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø·ÙˆØ±
        async function sendMessageAsDev() {
            if (!appState.isDevMode) return;
            
            const message = devMessageInput.value.trim();
            
            if (message === '') {
                return;
            }
            
            try {
                const messageData = {
                    text: message,
                    senderId: 'dev',
                    senderUsername: 'Ø§Ù„Ù…Ø·ÙˆØ±',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    type: 'dev'
                };
                
                await db.collection('messages').add(messageData);
                devMessageInput.value = '';
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø·ÙˆØ±:', error);
            }
        }
        
        // ØªØ«Ø¨ÙŠØª Ø±Ø³Ø§Ù„Ø©
        async function pinMessage() {
            if (!appState.isDevMode) return;
            
            const message = pinMessageInput.value.trim();
            
            if (message === '') {
                return;
            }
            
            try {
                await db.collection('pinned_messages').doc('current').set({
                    text: message,
                    sender: 'Ø§Ù„Ù…Ø·ÙˆØ±',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                pinMessageInput.value = '';
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
            }
        }
        
        // Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        async function unpinMessage() {
            if (!appState.isDevMode) return;
            
            try {
                await db.collection('pinned_messages').doc('current').delete();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª:', error);
            }
        }
        
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹
        async function disableSending() {
            if (!appState.isDevMode) return;
            
            appState.sendingEnabled = false;
            messageInput.disabled = true;
            sendBtn.disabled = true;
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
            try {
                await db.collection('messages').add({
                    text: 'Ø§Ù„Ù…Ø·ÙˆØ± Ù‚Ø§Ù… Ø¨ØªØ¹Ø·ÙŠÙ„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹.',
                    senderId: 'system',
                    senderUsername: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    type: 'dev'
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
            }
        }
        
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹
        async function enableSending() {
            if (!appState.isDevMode) return;
            
            appState.sendingEnabled = true;
            messageInput.disabled = false;
            sendBtn.disabled = false;
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
            try {
                await db.collection('messages').add({
                    text: 'Ø§Ù„Ù…Ø·ÙˆØ± Ù‚Ø§Ù… Ø¨ØªÙØ¹ÙŠÙ„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.',
                    senderId: 'system',
                    senderUsername: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    type: 'dev'
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        async function handleLogout() {
            try {
                // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø´Ø·
                if (appState.currentUser) {
                    await db.collection('active_users').doc(appState.currentUser.id).delete();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù†Ø´Ø§Ø·:', error);
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            if (appState.unsubscribeMessages) {
                appState.unsubscribeMessages();
            }
            if (appState.unsubscribePinned) {
                appState.unsubscribePinned();
            }
            if (appState.unsubscribeUsers) {
                appState.unsubscribeUsers();
            }
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            localStorage.removeItem('chat_user');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            appState.currentUser = null;
            appState.isDevMode = false;
            appState.sendingEnabled = true;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
            loginUsername.value = '';
            loginPassword.value = '';
            registerUsername.value = '';
            registerPassword.value = '';
            registerConfirmPassword.value = '';
            
            // Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
            topBar.style.display = 'none';
            chatContainer.style.display = 'none';
            footer.style.display = 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            authContainer.style.display = 'flex';
            switchAuthTab('login');
            
            // Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
            devPanel.classList.remove('active');
            hamburger.classList.remove('active');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            messagesContainer.innerHTML = '';
        }
        
        // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±
        function toggleDevPanel() {
            if (!appState.isDevMode) return;
            
            devPanel.classList.toggle('active');
            hamburger.classList.toggle('active');
        }
        
        // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø£Ø­Ø¯Ø« Ø±Ø³Ø§Ù„Ø©
        function scrollToBottom() {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>